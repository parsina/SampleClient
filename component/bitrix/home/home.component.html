<div fxLayout="column" fxLayoutAlign="start stretch" class="sticky">
  <mat-divider class="header-devider"></mat-divider>
  <mat-divider class="header-devider"></mat-divider>
  <mat-toolbar color="primary" class="toolbar">

    <button mat-button style="font-size: small; font-weight: bold" (click)="updateAccountData()" matTooltip="Update account data">
      <mat-icon>account_balance</mat-icon>
      {{userData.balance}} BTC
    </button>

    <span class="toolbar">

      <a mat-button class="mainButton" matTooltip="Change Password" (click)="changePasswordDialog()">
        <mat-icon>account_circle</mat-icon>
      </a>

      <a mat-button *ngIf="userData.userRole === 'ROLE_ADMIN'" [routerLink]="['/Admin']" class="mainButton">
        <mat-icon>lock_open</mat-icon>
      </a>
    </span>

    <button mat-button style="font-size: small;" matTooltip="Sign out" (click)="logout()" class="mainButton">
      {{userData.username}}
      <mat-icon>exit_to_app</mat-icon>
    </button>

  </mat-toolbar>
  <mat-divider class="header-devider"></mat-divider>
  <mat-divider class="header-devider"></mat-divider>
</div>
<br/>
<div fxLayout='column'>
  <mat-card>
    <mat-card-title style="font-size: small; font-weight: bold; text-align: center;">
      Your node
    </mat-card-title>
    <mat-card-content fxLayout="row" fxLayout.lt-md="column" fxLayoutAlign="center stretch">
      <mat-card fxFlex="100%" style="border: #555555 1px solid ;margin: 2px;">
        <mat-card-title style="font-size: small; font-weight: bold;text-align: center">Reference</mat-card-title>
        <mat-card-content fxLayoutAlign="center stretch" style="font-size: small; color: blue;">
          {{userData.reference}}
        </mat-card-content>
        <mat-card-footer fxLayoutAlign="center stretch" style="font-size: small; color: blue; margin-bottom: 2px;">
          <mat-icon>people</mat-icon>
        </mat-card-footer>
      </mat-card>

      <mat-card fxFlex="100%" style="border: #555555 1px solid ;margin: 2px;">
        <mat-card-title style="font-size: small; font-weight: bold; text-align: center;">Plan</mat-card-title>
        <mat-card-content fxLayoutAlign="center stretch" style="font-size: small;color: blue;">
          {{userData.plan}}
        </mat-card-content>
        <mat-card-footer *ngIf="userData.plan === 'STARTER'" fxLayoutAlign="center stretch" style="font-size: small; color: lightskyblue; margin-bottom: 2px;">
          <mat-icon>lens</mat-icon>
        </mat-card-footer>
        <mat-card-footer *ngIf="userData.plan === 'BRONZE'" fxLayoutAlign="center stretch" style="font-size: small; color: sandybrown; margin-bottom: 2px;">
          <mat-icon>lens</mat-icon>
        </mat-card-footer>
        <mat-card-footer *ngIf="userData.plan === 'SILVER'" fxLayoutAlign="center stretch" style="font-size: small; color: silver; margin-bottom: 2px;">
          <mat-icon>lens</mat-icon>
        </mat-card-footer>
        <mat-card-footer *ngIf="userData.plan === 'GOLD'" fxLayoutAlign="center stretch" style="font-size: small; color: gold; margin-bottom: 2px;">
          <mat-icon>lens</mat-icon>
        </mat-card-footer>
      </mat-card>

      <mat-card fxFlex="100%" style="border: #555555 1px solid; margin: 2px;">
        <mat-card-title style="font-size: small; font-weight: bold; text-align: center;">Stars</mat-card-title>
        <mat-card-content fxLayoutAlign="center stretch" style="font-size: small; color: blue;">
          {{userData.step}}
        </mat-card-content>
        <mat-card-footer fxLayoutAlign="center stretch" style="font-size: small; color: blue; margin-bottom: 2px;">
          <mat-icon>{{userData.step > 0 ? 'star' : 'star_border'}}</mat-icon>
          <mat-icon>{{userData.step > 1 ? 'star' : 'star_border'}}</mat-icon>
          <mat-icon>{{userData.step > 2 ? 'star' : 'star_border'}}</mat-icon>
          <mat-icon>{{userData.step > 3 ? 'star' : 'star_border'}}</mat-icon>
          <mat-icon>{{userData.step > 4 ? 'star' : 'star_border'}}</mat-icon>
        </mat-card-footer>

      </mat-card>

      <mat-card fxFlex="100%" style="border: #555555 1px solid; margin: 2px;">
        <mat-card-title style="font-size: small; font-weight: bold; text-align: center;">Nodes</mat-card-title>
        <mat-card-content fxLayoutAlign="center stretch" style="font-size: small;color: blue;">
          {{userData.nodes}}
        </mat-card-content>
        <mat-card-footer fxLayoutAlign="center stretch" style="font-size: small; color: blue; margin-bottom: 2px;">
          <mat-progress-bar style="margin-top: 5%;" fxFlex="80%" mode="determinate" value="{{userData.nodes >= 30 ? 100 : userData.nodes * 3.33}}"
                            matTooltip="{{userData.nodes >= 30 ? 30 : userData.nodes}} out of 30"></mat-progress-bar>
        </mat-card-footer>
      </mat-card>

      <mat-card fxFlex="100%" *ngIf="userData.nodes < 30" style="border: #555555 1px solid; margin: 2px;">
        <mat-card-title style="font-size: small; font-weight: bold; text-align: center;">Status</mat-card-title>
        <mat-card-content *ngIf="userData.status === 'ACTIVE'" fxLayoutAlign="center stretch" style="font-size: small;color: blue;">
          {{userData.status}}
        </mat-card-content>
        <mat-card-content *ngIf="userData.status != 'ACTIVE'" fxLayoutAlign="center stretch" style="font-size: small;color: red;">
          {{userData.status}}
        </mat-card-content>
        <mat-card-footer *ngIf="userData.status === 'ACTIVE'" fxLayoutAlign="center stretch" style="font-size: small; margin-bottom: 2px; color: blue">
          <mat-icon >thumb_up</mat-icon>
        </mat-card-footer>
        <mat-card-footer *ngIf="userData.status != 'ACTIVE'" fxLayoutAlign="center stretch" style="font-size: small; margin-bottom: 2px; color: red">
          <mat-icon>thumb_down</mat-icon>
        </mat-card-footer>
      </mat-card>

      <mat-card fxFlex="100%" *ngIf="userData.status === 'ACTIVE'" style="border: #555555 1px solid; margin: 2px;">
        <mat-card-title style="font-size: small; font-weight: bold; text-align: center;">Invitation Link
        </mat-card-title>
        <mat-card-content fxLayoutAlign="center stretch" style="font-size: small;color: blue; text-align: center;">
          <label style="font-size: small;">
            {{userData.refereeURL}}
          </label>
        </mat-card-content>
        <mat-card-footer fxLayoutAlign="center stretch" style="font-size: small; color: blue; margin-bottom: 2px;">
          <a mat-button matTooltip="Click to copy your invitation link" style="color: blue;" (click)="copyToClipboard('link')">
            <mat-icon color="blue">file_copy</mat-icon>
          </a>
        </mat-card-footer>
      </mat-card>

      <button fxFlex="100%" *ngIf="userData.status === 'INACTIVE' && userData.nodes === 0" mat-stroked-button color="primary" class="bitrixButton" (click)="activateNode()" matTooltip="Click to activate your node">
        Activate level {{userData.step + 1}}<br/>
        ({{nodePrice}} BTC)
      </button>

      <button fxFlex="100%" *ngIf="userData.status === 'INACTIVE' && userData.nodes >= 30 && userData.step < 5 && userData.plan != 'GOLD'" mat-stroked-button color="primary" class="bitrixButton" (click)="completeMatrix()" matTooltip="Click to complete this matrix and get your income">
        Awesome !
        <br/>
        You've finished matrix on level {{userData.step}}
      </button>
      <button fxFlex="100%" *ngIf="userData.status === 'INACTIVE' && userData.nodes >= 30 && userData.step === 5 && userData.plan != 'GOLD'" mat-stroked-button color="primary" class="bitrixButton" (click)="startNewPlan()" matTooltip="Click to complete this matrix, get your income and start next plan">
        Congratulations !
        <br/>
        You've finished matrix on level {{userData.step}} and completed {{userData.plan}} plan.
      </button>
    </mat-card-content>
    <mat-card-footer fxLayoutAlign="center stretch" style="font-size: small; color: blue; margin-bottom: 2px;">
      <button fxFlex="95%" *ngIf="userData.status === 'INACTIVE' && userData.nodes >= 30 && userData.step === 5 && userData.plan === 'GOLD'"  mat-stroked-button color="primary" class="bitrixButton" (click)="startNewPlan()" matTooltip="Click to complete this matrix, get your income and start a new round in STARTER plan">
        Perfect !
        <br/>
        You've finished matrix on level {{userData.step}} and completed {{userData.plan}} plan.
        It is the latest plan in a round and by clicking here you'll start again from STARTER plan.
      </button>
    </mat-card-footer>
  </mat-card>
</div>
<br/>

<div fxLayout="row" fxLayout.lt-md="column" fxLayoutAlign="center stretch">
  <mat-card fxFlex="100%" style="margin: 1px;">
    <mat-card-title style="font-size: small; font-weight: bold; text-align: center;">Your left node</mat-card-title>
    <mat-card-content *ngIf="leftNodeData.username  === ''" style="font-size: small; text-align: center;">
      You don't have a left node yet.
    </mat-card-content>
    <mat-card-content *ngIf="leftNodeData.username != ''" fxLayout="row" fxLayoutAlign="center stretch">
      <mat-card fxFlex="100%" style="border: #555555 1px solid; margin: 2px;">
        <mat-card-title style="font-size: small; font-weight: bold;text-align: center">Username</mat-card-title>
        <mat-card-content fxLayoutAlign="center stretch" style="font-size: small; color: blue;">
          {{leftNodeData ? leftNodeData.username: ''}}
        </mat-card-content>
      </mat-card>
      <mat-card fxFlex="100%" style="border: #555555 1px solid; margin: 2px;">
        <mat-card-title style="font-size: small; font-weight: bold;text-align: center">Nodes</mat-card-title>
        <mat-card-content fxLayoutAlign="center stretch" style="font-size: small; color: blue;">
          {{leftNodeData ? (leftNodeData.nodes > 14 ? 14 : leftNodeData.nodes) : ''}}
        </mat-card-content>
      </mat-card>
      <mat-card fxFlex="100%" style="border: #555555 1px solid; margin: 2px;">
        <mat-card-title style="font-size: small; font-weight: bold;text-align: center">Status</mat-card-title>
        <mat-card-content fxLayoutAlign="center stretch" style="font-size: small; color: blue;">
          {{leftNodeData ? leftNodeData.status : ''}}
        </mat-card-content>
      </mat-card>
    </mat-card-content>
  </mat-card>
  <mat-card fxFlex="100%" style="margin: 1px;">
    <mat-card-title style="font-size: small; font-weight: bold; text-align: center;">Your right node</mat-card-title>
    <mat-card-content *ngIf="rightNodeData.username === ''" style="font-size: small; text-align: center;">
      You don't have a right node yet.
    </mat-card-content>
    <mat-card-content *ngIf="rightNodeData.username != ''" fxLayout="row" fxLayoutAlign="center stretch">
      <mat-card fxFlex="100%" style="border: #555555 1px solid; margin: 2px;">
        <mat-card-title style="font-size: small; font-weight: bold;text-align: center">Username</mat-card-title>
        <mat-card-content fxLayoutAlign="center stretch" style="font-size: small; color: blue;">
          {{rightNodeData ? rightNodeData.username : ''}}
        </mat-card-content>
      </mat-card>
      <mat-card fxFlex="100%" style="border: #555555 1px solid; margin: 2px;">
        <mat-card-title style="font-size: small; font-weight: bold;text-align: center">Nodes</mat-card-title>
        <mat-card-content fxLayoutAlign="center stretch" style="font-size: small; color: blue;">
          {{rightNodeData ? (rightNodeData.nodes > 14 ? 14 : rightNodeData.nodes) : ''}}
        </mat-card-content>
      </mat-card>
      <mat-card fxFlex="100%" style="border: #555555 1px solid; margin: 2px;">
        <mat-card-title style="font-size: small; font-weight: bold;text-align: center">Status</mat-card-title>
        <mat-card-content fxLayoutAlign="center stretch" style="font-size: small; color: blue;">
          {{rightNodeData ? rightNodeData.status : ''}}
        </mat-card-content>
      </mat-card>
    </mat-card-content>
  </mat-card>
</div>

<br/>
<mat-expansion-panel fxLayout="column" fxLayoutAlign="center stretch">
  <mat-expansion-panel-header style="background-color:rgba(65,82,179,0.08); border-bottom: #555555 1px solid;">
    <mat-panel-title style="font-size: small; font-weight: bold; text-align: center;">
      Bitcoin
    </mat-panel-title>
    <mat-panel-description style="font-size: small; text-align: center;">
      Send/Receive bitcoin
    </mat-panel-description>
  </mat-expansion-panel-header>

  <br/>
  <div fxLayout="row" fxLayout.lt-md="column" fxLayoutAlign="center stretch">
    <mat-card fxFlex="100%" style="border: #555555 1px solid; background-color: #cee0c7; margin: 1px;">
      <mat-card-title style="font-size: small; font-weight: bold; text-align: center;">Receive Bitcoin</mat-card-title>
      <mat-card-content style="font-size: small; text-align: left;">
        Please use following address only for transferring Bitcoin to your account (not other crypto-currencies).
        Sending currencies except Bitcoin is not supported and
        result in a loss of your deposit.
        <br/><br/><br/>
        <label style="font-size: small; font-weight: bold; text-align: left;">Your Bitcoin Address: </label>
        <label style="font-size: small; font-weight: bold; text-align: left; color: rgba(238, 25, 0, 0.8);">
          {{userData.address}}
        </label>
        <a mat-button matTooltip="Click to copy your Bitcoin wallet address" style="color: blue;" (click)="copyToClipboard('address')">
          <mat-icon color="blue">file_copy</mat-icon>
        </a>
      </mat-card-content>
    </mat-card>
    <mat-card fxFlex="100%" style="border: #555555 1px solid; background-color: #f9e9db; margin: 1px;">
      <mat-card-title style="font-size: small; font-weight: bold; text-align: center;">
        Send Bitcoin
      </mat-card-title>
      <mat-card-content style="font-size: small; text-align: left;">
        Please be sure about the destination address. There is no way to revert transaction after sending Bitcoins.
        <br/><br/>
        <div>
          <section>
            <label style="font-size: small; font-weight: bold; text-align: left; margin-right: 20px;">Balance&nbsp;&nbsp;</label>
            <label style="font-size: small; font-weight: bold; text-align: left;">{{userData.balance}} </label>
          </section>

          <section>
            <label style="font-size: small; font-weight: bold; text-align: left; margin-right: 20px;">Available</label>
            <label style="font-size: small; font-weight: bold; text-align: left;">{{accessibleBalance}} </label>
          </section>

          <section *ngIf="amount">
            <label style="font-size: small; font-weight: bold; text-align: left; margin-right: 20px;">Fee&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</label>
            <label style="font-size: small; font-weight: bold; text-align: left;">{{feeValue}} </label>
          </section>
          <br/>

          <section fxLayout="row" fxLayout.lt-md="column" fxLayoutAlign="center stretch">
            <mat-form-field style="font-size: small; font-weight: bold; text-align: left; margin-right: 10px;" matTooltip="Minimum withdrawal value is 0.0005 BTC">
              <input #amountValue fxFlex="100%" type="text" matInput [(ngModel)]="amount" (blur)="setAmount(amountValue.value)" placeholder="Amount(BTC)" style="font-size: small; font-weight: bold; text-align: left;">
              <button mat-button *ngIf="amount" matSuffix mat-icon-button aria-label="Delete" (click)="setAmount('');">
                <mat-icon>close</mat-icon>
              </button>
            </mat-form-field>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <mat-form-field fxFlex="100%" style="font-size: small; font-weight: bold; text-align: left; margin-right: 10px;color: red;" matTooltip="Please enter the destination Bitcoin address">
              <input type="text" matInput [(ngModel)]="forwardAddress" placeholder="Destination address" style="font-size: small; font-weight: bold; text-align: left;">
            </mat-form-field>
          </section>
          <br/>
          <section fxLayout="row" fxLayout.lt-md="column" fxLayoutAlign="center stretch">
            <button fxFlex="100%" style="font-size: small; font-weight: bold; text-align: center; margin-right: 10px;" (click)="sendSecurityCode()" mat-raised-button [hidden]="securityCode">
              Send security code
            </button>
            &nbsp;&nbsp;&nbsp;
            <mat-form-field *ngIf="securityCode" style="font-size: small; font-weight: bold; text-align: center; margin-right: 10px;" matTooltip="Please check your email and enter the security code sent to you.">
              <input fxFlex="100%" type="text" style="font-size: small; font-weight: bold; text-align: center;" matInput [(ngModel)]="userSecurityCode" placeholder="Security code">
            </mat-form-field>

            <button fxFlex="100%" *ngIf="securityCode" (click)="sendCoins()" mat-raised-button [hidden]="!userSecurityCode" style="font-size: small; font-weight: bold; text-align: center; margin-right: 10px;">
              Send Bitcoin
            </button>
          </section>
          <br/>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
  <br/>

  <mat-table *ngIf="screenWidth < 960" [dataSource]="transactionDataSource" matSort matSortActive="updateDate" matSortDirection="desc" matSortDisableClear>

    <!-- Index Column -->
    <ng-container matColumnDef="index">
      <mat-header-cell *matHeaderCellDef></mat-header-cell>
      <mat-cell *matCellDef="let index = index" style="color: #ac98f2;font-size: small;font-weight: bold;">{{index +
        1}}
      </mat-cell>
    </ng-container>

    <!-- Date Column -->
    <ng-container matColumnDef="updateDate">
      <mat-header-cell *matHeaderCellDef mat-sort-header style="font-size: small; font-weight: bold;">
        Date
      </mat-header-cell>
      <mat-cell *matCellDef="let element" style="font-size: small;text-align: left;">
        {{element.properties.updateDat}}
        {{element.properties.updateTime}}
      </mat-cell>
    </ng-container>

    <!-- Date Column -->
    <ng-container matColumnDef="type">
      <mat-header-cell *matHeaderCellDef mat-sort-header style="font-size: small; font-weight: bold;">
        Type
      </mat-header-cell>
      <mat-cell *matCellDef="let element" style="font-size: small;text-align: left;">
        {{element.properties.type}}
      </mat-cell>
    </ng-container>

    <!-- Value Column -->
    <ng-container matColumnDef="amount">
      <mat-header-cell *matHeaderCellDef mat-sort-header style="font-size: small; font-weight: bold;">
        Amount(BTC)
      </mat-header-cell>
      <mat-cell *matCellDef="let element" style="font-size: small;text-align: left;">
        {{element.properties.value / 100000000}}
      </mat-cell>
    </ng-container>

    <!-- Value Column -->
    <ng-container matColumnDef="fee">
      <mat-header-cell *matHeaderCellDef mat-sort-header style="font-size: small; font-weight: bold;">
        Fee(BTC)
      </mat-header-cell>
      <mat-cell *matCellDef="let element" style="font-size: small;text-align: left;">
        {{element.properties.fee / 100000000}}
      </mat-cell>
    </ng-container>

    <!-- Status Column -->
    <ng-container matColumnDef="status">
      <mat-header-cell *matHeaderCellDef mat-sort-header style="font-size: small; font-weight: bold;">
        Status
      </mat-header-cell>
      <mat-cell *matCellDef="let element" style="font-size: small;text-align: left;">
        <img [hidden]="element.properties.status === 'UNCONFIRMED'" src="../../../../assets/img/{{element.properties.status}}.ico" width="30px" height="30px">
        <img [hidden]="element.properties.status != 'UNCONFIRMED'" src="../../../../assets/img/waiting.gif" width="30px" height="30px">
      </mat-cell>
    </ng-container>

    <!-- Date Column -->
    <ng-container matColumnDef="description">
      <mat-header-cell *matHeaderCellDef mat-sort-header style="font-size: small; font-weight: bold;width: 200px;">
        Description
      </mat-header-cell>
      <mat-cell *matCellDef="let element" style="font-size: small; width: 200px;text-align: left;">
        {{element.properties.description}}
      </mat-cell>
    </ng-container>

    <mat-header-row style="background-color: #5BC0DE;" *matHeaderRowDef="transactionsColumns"></mat-header-row>
    <mat-row [ngClass]="{'row1': index%2 == 0, 'row2': index%2 == 1}" *matRowDef="let row; columns: transactionsColumns; let index = index"></mat-row>

  </mat-table>
  <mat-table *ngIf="screenWidth >= 960" fxLayout="column" fxLayoutAlign="center stretch" [dataSource]="transactionDataSource" matSort matSortActive="updateDate" matSortDirection="desc" matSortDisableClear>

    <!-- Index Column -->
    <ng-container matColumnDef="index">
      <mat-header-cell *matHeaderCellDef></mat-header-cell>
      <mat-cell *matCellDef="let index = index" style="color: #ac98f2;font-size: small;font-weight: bold;">{{index +
        1}}
      </mat-cell>
    </ng-container>

    <!-- Date Column -->
    <ng-container matColumnDef="updateDate">
      <mat-header-cell *matHeaderCellDef mat-sort-header style="font-size: small; font-weight: bold;">
        Date
      </mat-header-cell>
      <mat-cell *matCellDef="let element" style="font-size: small;text-align: left;">
        {{element.properties.updateDat}}
        {{element.properties.updateTime}}
      </mat-cell>
    </ng-container>

    <!-- Date Column -->
    <ng-container matColumnDef="type">
      <mat-header-cell *matHeaderCellDef mat-sort-header style="font-size: small; font-weight: bold;">
        Type
      </mat-header-cell>
      <mat-cell *matCellDef="let element" style="font-size: small;text-align: left;">
        {{element.properties.type}}
      </mat-cell>
    </ng-container>

    <!-- Value Column -->
    <ng-container matColumnDef="amount">
      <mat-header-cell *matHeaderCellDef mat-sort-header style="font-size: small; font-weight: bold;">
        Amount(BTC)
      </mat-header-cell>
      <mat-cell *matCellDef="let element" style="font-size: small;text-align: left;">
        {{element.properties.value / 100000000}}
      </mat-cell>
    </ng-container>

    <!-- Value Column -->
    <ng-container matColumnDef="fee">
      <mat-header-cell *matHeaderCellDef mat-sort-header style="font-size: small; font-weight: bold;">
        Fee(BTC)
      </mat-header-cell>
      <mat-cell *matCellDef="let element" style="font-size: small;text-align: left;">
        {{element.properties.fee / 100000000}}
      </mat-cell>
    </ng-container>

    <!-- Status Column -->
    <ng-container matColumnDef="status">
      <mat-header-cell *matHeaderCellDef mat-sort-header style="font-size: small; font-weight: bold;">
        Status
      </mat-header-cell>
      <mat-cell *matCellDef="let element" style="font-size: small;text-align: left;">
        <img [hidden]="element.properties.status === 'UNCONFIRMED'" src="../../../../assets/img/{{element.properties.status}}.ico" width="30px" height="30px">
        <img [hidden]="element.properties.status != 'UNCONFIRMED'" src="../../../../assets/img/waiting.gif" width="30px" height="30px">
      </mat-cell>
    </ng-container>

    <!-- Date Column -->
    <ng-container matColumnDef="description">
      <mat-header-cell *matHeaderCellDef mat-sort-header style="font-size: small; font-weight: bold;width: 200px;">
        Description
      </mat-header-cell>
      <mat-cell *matCellDef="let element" style="font-size: small; width: 200px;text-align: left;">
        {{element.properties.description}}
      </mat-cell>
    </ng-container>

    <mat-header-row style="background-color: #5BC0DE;" *matHeaderRowDef="transactionsColumns"></mat-header-row>
    <mat-row [ngClass]="{'row1': index%2 == 0, 'row2': index%2 == 1}" *matRowDef="let row; columns: transactionsColumns; let index = index"></mat-row>

  </mat-table>
  <div style="display: flex !important;justify-content: center !important;background-color: #d0d1d5;">
    <mat-paginator [showFirstLastButtons]="true" [length]="transactionSize" [pageSize]="10" [pageSizeOptions]="[5, 10, 50, 100]" style="background-color: #d0d1d5;"></mat-paginator>
  </div>
</mat-expansion-panel>



